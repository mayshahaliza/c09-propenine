<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agent Performance</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
        }

        /* .container {
            max-width: 85%; 
        } */

        .card-header {
            background-color: #eeeeef;
            color: #3c3f61;
        }

        /* h1 {
            color: #343a40;
            text-align: center;
            margin-bottom: 30px;
        } */

        .filter-form {
            margin-bottom: 10px;
        }

        .filter-label {
            margin-bottom: 5px;
        }

        .pesanan-table th {
            background-color: #eeeeef; /* Mengubah latar belakang ke #eeeeef */
            color: #3c3f61; /* Mengubah warna teks */
            text-align: center;
        }

        .pesanan-table td,
        .pesanan-table th {
            text-align: center;
            vertical-align: middle;
        }

        .btn-create {
            margin-top: 20px;
            float: right;
        }

        .text-dark {
            color: #000; /* Black color for Ongoing status */
        }

        .text-danger {
            color: #ff0000; /* Red color for Canceled status */
        }

        .btn-submit {
            background-color: #3c3f61;
            color: #fff;
            width: auto;
            padding: 5px 10px; /* Sesuaikan padding tombol */
            font-size: 14px; /* Sesuaikan ukuran teks */
        }

        .btn-submit:hover {
            background-color: #2e314a;
        }

        .add-product-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #0e131a;
            color: #fff;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            padding: 15px;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s, transform 0.3s;
        }

        .text-success {
            color: #008000; /* Green color for Complete status */
        }

        .layout_padding {
            padding: 90px 0;
        }

        .layout_padding-top {
            padding-top: 90px;
        }

        .layout_padding-bottom {
            padding-bottom: 90px;
        }

        .layout_margin-top {
            margin-top: 20px;
        }

        .layout_margin-bottom {
            margin-bottom: 20px;
        }

    </style>
</head>

<body>

    <!-- Navbar -->
    <div th:switch="${user.role}">
        <div th:case="'admin'">
            <nav th:replace="~{fragments/admin_navbar :: admin_navbar}"></nav>
        </div>
        <div th:case="'operational'">
            <nav th:replace="~{fragments/hr_navbar :: hr_navbar}"></nav>
        </div>
    </div>

    <!-- Content -->
    <div class="container layout_padding-top layout_padding-bottom layout_margin-top layout_margin-bottom">
        <div class="card">
            <div class="card-header text-center">
                <h2 th:text="${karyawan.nama_depan + ' ' + karyawan.nama_belakang + ' Performance'}"></h2>
            </div>
            <div class="card-body">
                <div class="container filter-form">
                    <form th:action="@{/karyawan/performance/{id}(id=${karyawan.id})}" method="get">
                        <div class="row">
                            <div class="col-md-4 form-group">
                                <label class="filter-label" for="bulan">Month:</label>
                                <select name="bulan" id="bulan" class="form-control">
                                    <option value="">Select Month</option>
                                    <option value="1">January</option>
                                    <option value="2">February</option>
                                    <option value="3">March</option>
                                    <option value="4">April</option>
                                    <option value="5">May</option>
                                    <option value="6">June</option>
                                    <option value="7">July</option>
                                    <option value="8">August</option>
                                    <option value="9">September</option>
                                    <option value="10">October</option>
                                    <option value="11">November</option>
                                    <option value="12">December</option>
                                </select>
                            </div>
                
                            <div class="col-md-4 form-group">
                                <label class="filter-label" for="tahun">Year:</label>
                                <input type="text" name="tahun" id="tahun" class="form-control" placeholder="Enter Year">
                            </div>
                
                            <div class="col-md-4 form-group">
                                <label class="filter-label" for="statusPesanan">Order Status:</label>
                                <select name="statusPesanan" id="statusPesanan" class="form-control">
                                    <option value="">Select Status</option>
                                    <option value="Ongoing">Ongoing</option>
                                    <option value="Complete">Complete</option>
                                    <option value="Canceled">Canceled</option>
                                </select>
                            </div>
                        </div>
        
                        <div class="col-md-4">
                            <button type="submit" class="btn btn-primary btn-block" style="background-color: #3c3f61;">Filter</button>
                        </div>                 
                    </form>
                </div>                
            

                <div class="table-responsive">
                    <table id="myTable" class="table table-striped table-bordered pesanan-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Client Name</th>
                                <th>Username Agent</th>
                                <th data-sort="canceled">Order Status</th>
                                <th>Product</th>
                                <th>Total Order Cost</th>
                                <th>Start Order</th>
                                <th>Complete Order</th>
                                <th>Actions</th>
                            </tr>
                        </thead>

                        <tbody>
                            <!-- Data Rows -->
                            <tr th:each="pesanan : ${pesananList}">
                                <td th:text="${pesanan.id}">ID</td>
                                <td th:text="${pesanan.klien.namaKlien}">Client Name</td>
                                <td th:text="${pesanan.user.username}">Username Agent</td>
                                <td>
                                    <span th:text="${pesanan.statusPesanan}"
                                        th:class="${pesanan.statusPesanan == 'Canceled' ? 'text-danger' : (pesanan.statusPesanan == 'Complete' ? 'text-success' : 'text-dark')}"></span>
                                </td>
                                <td th:text="${pesanan.product.namaProduct}">Product</td>
                                <!-- Format total biaya pesanan -->
                                <td th:text="'Rp ' + ${#numbers.formatDecimal(pesanan.jumlahBiayaPesanan, 0, 'COMMA', 0, 'POINT')}"</td>
                                <td th:text="${pesanan.tanggalPemesanan}">Start Order</td>
                                <td th:text="${pesanan.tanggalSelesai}">Complete Order</td>
                                <td>
                                    <a th:href="@{/pesanan/update/{id}(id=${pesanan.id})}"
                                        class="btn btn-submit">Edit</a>
                                    <th:block th:if="${pesanan.statusPesanan != 'Ongoing'}">
                                        <a th:href="@{/pesanan/delete/{id}(id=${pesanan.id})}" class="btn btn-danger btn-sm"
                                            th:onclick="'return confirm(\'Are you sure?\')'">Delete</a>
                                    </th:block>
                                </td>
                            </tr>
                            <tr th:if="${#lists.isEmpty(pesananList)}">
                                <td colspan="9" class="text-center">No orders found.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <!-- DataTables JS -->
    <script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script>
    $(document).ready(function() {
        $('#myTable').DataTable({
            columnDefs: [
                { targets: 3, type: 'status-order' }
            ],
            order: []
        });

        // Tambahkan definisi sorting kustom untuk kolom status
        $.fn.dataTable.ext.type.order['status-order'] = function(settings, col) {
            return this.api().column(col, { order: 'index' }).nodes().map(function(td, i) {
                var status = $(td).text();
                switch (status) {
                    case 'Ongoing':
                        return 0;
                    case 'Complete':
                        return 1;
                    case 'Canceled':
                        return 2;
                    default:
                        return 3;
                }
            });
        };
    });
    </script>
</body>

<div th:unless="${user.role == 'hr' || user.role =='admin'}">
    <script th:inline="javascript">
        /*<![CDATA[*/
        window.location.replace('/no-access');
        /*]]>*/
    </script>
</div>

</html>
